# チケット管理システムデータベース関連ドキュメント

## 概要

このドキュメントでは、チケット管理システムで使用されるデータベースの構造と主要な機能について説明します。システムは、イベントチケットの管理とユーザープロフィールの管理を効率的に行うために設計されています。

## テーブル構造

### 1. profiles（プロフィール）テーブル

このテーブルはユーザープロフィールを管理します。

### 2. tickets（チケット）テーブル

#### チケットタイプ（ticket_type enum）

1. sponsor_booth: スポンサーブースの運営で来場（ノベルティなし）
2. sponsor_invited: スポンサー招待チケット
3. individual_sponsor: 個人スポンサーチケット
4. general: 一般チケット
5. regular_speaker: 普通のセッション登壇者
6. sponsor_speaker: スポンサーセッション登壇チケット

#### 注意点

- `user_id`フィールドは、`auth.users`テーブルを参照し、チケットを所有するユーザーを追跡します。
- チケットタイプによって、異なる権限や特典を設定することができます。例えば：
  - スポンサーブース運営者は特定のエリアにアクセスできる
  - スポンサー招待チケットは特別なイベントに参加できる
  - 登壇者（regular_speakerとsponsor_speaker）は講演者用の待機室にアクセスできる
- システムの要件に応じて、各チケットタイプに関連する追加の属性（例：有効期限、特典内容など）を設定することを検討してください。

## セキュリティ考慮事項

- Row Level Security (RLS)を使用して、ユーザーが適切なデータにのみアクセスできるようにします。
- 以下のRLSポリシーを設定しています：
  - 管理者はすべてのチケットを表示可能
  - 管理者はすべてのチケットを作成可能
  - 管理者はすべてのチケットを更新可能
  - 管理者はすべてのチケットを削除可能
- すべてのデータベース操作はログに記録し、定期的に監査します。

## パフォーマンス最適化

- 頻繁にアクセスされるクエリにはインデックスを作成します。
- 大規模なイベントの場合、チケット発行処理をキューイングシステムで管理し、データベースの負荷を分散させます。

## バックアップと復旧

- データベースの完全バックアップを毎日実行します。
- ポイントインタイムリカバリ（PITR）を設定し、障害発生時に迅速に復旧できるようにします。

このドキュメントは、チケット管理システムのデータベース設計の基本的な概要を提供しています。実際の実装時には、具体的な要件やスケーラビリティのニーズに応じて、さらなる最適化や機能の追加が必要になる場合があります。
